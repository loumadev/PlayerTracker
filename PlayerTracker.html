<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
	<title>PlayerTracker by MataxePlay</title>
	<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
</head>
<body>
<div class="view" style="display:inline-block;vertical-align:top;">
	<div class="map">
		<div class="dot"></div>
		<div class="map-inner" style="height:0;width:0;top:0px;left:0px;">
			<div class="circle1" style="transform: translate(-50%, -50%);"></div>
			<div class="circle2" style="transform: translate(-50%, -50%);"></div>
		</div>
	</div>
	<div class="panel">
		<div class="coords">
			<span class="coord m">X: 0 Z: 0</span>
			<span class="coord c">X: 0 Z: 0</span>
		</div>
		<div class="options">
			<button class="ab"></button> <button class="bb"></button> <button class="cb"></button>
		</div>
		<div class="settings">
			<div class="aSharp"><input type="checkbox" checked> Auto Sharp <input type="checkbox" checked> Auto Ajust</div>
		</div>
	</div>
</div>
<div style="display:inline-block">
	<input type="text" placeholder="X1" style="width:50px"> <input type="text" placeholder="Z1" style="width:50px"> <input type="text" placeholder="Radius1" style="width:50px"><br><br>
	<input type="text" placeholder="X2" style="width:50px"> <input type="text" placeholder="Z2" style="width:50px"> <input type="text" placeholder="Radius2" style="width:50px"><br><br>
	<input type="text" placeholder="Coordinates1" style="outline:none;width:166px;text-align:center" readonly><br><br>
	<input type="text" placeholder="Coordinates2" style="outline:none;width:166px;text-align:center" readonly><br><br>
	<button style="width:170px">Calculate</button>
</div>
<style>
html {
	overflow: hidden;
}
.map {
	width: 600px;
	height: 600px;
	overflow: hidden;
	border: 2px solid black;
	background: gray;
	transition: .25s
}
.map-inner {
	position: relative;
	top: 0;
	left: 0;
	background: darkgray;
	width: 4128px;
	height: 4128px;
	cursor: default;
	/*image-rendering: pixelated;*/
	/*background-image: url(https://i.imgur.com/zDzKoow.png);*/
	background-image: url(https://i.imgur.com/XM5vxQw.jpg);
	background-repeat: no-repeat;
	background-position: center;
	background-size: cover;
	transition: .25s;
}
.circle1, .circle2 {
	position: absolute;
	height: 0px;
	width: 0px;
	border: 2px solid red;
	border-radius: 50%;
	pointer-events: none;
	transform: translate(-50%, -50%);
	transition: all .25s;
}
.circle2 {
	border-color: blue;
}
.panel {
	height: 50px;
	width: 592px;
	padding: 0 4px;
	background: #303030;
	border: 2px solid black;
	color: white;
	font-family: Arial;
	font-size: 18px;
	cursor: default;
	transition: .25s;
}
.dot {
	position: relative;
	top: 50%;
	left: 50%;
    /*top: 508px;
    left: 307px;*/
    height: 0;
	width: 0;
	/*border: 3px solid red;*/
	/*border-radius: 50%;*/
	outline: 1.5px solid red;
	z-index: 100;
}
.coords {
	height: 21px;
}
.coord.m, .options {
	position: relative;
	float: left;
}
.coord.c, .settings {
	position: relative;
	float: right;
}
.ab, .bb, .cb {
	height: 25px;
	width: 25px;
	border: none;
	border-radius: 2px;
	outline: none;
	background-color: #6d6d6d;
	background-size: 18px;
	background-position: center;
	background-repeat: no-repeat;
	cursor: pointer;
	transition: .25s;
}
.options button:hover {
	background-color: #5e5e5e;
}
.ab {
	background-image: url(https://i.imgur.com/dm7eCQh.jpg);
	background-size: 21px;
}
.bb {
	background-image: url(https://i.imgur.com/U3zBLSz.jpg);
}
.cb {
	background-image: url(https://i.imgur.com/SV8ePDQ.jpg);
}
</style>
<script>

var c1 = document.getElementsByClassName("circle1")[0];
var c2 = document.getElementsByClassName("circle2")[0];
var map = document.getElementsByClassName("map")[0];
var mInner = document.getElementsByClassName("map-inner")[0];
var panel = document.getElementsByClassName("panel")[0];
var coords = document.getElementsByClassName("coord");
var dot = document.getElementsByClassName("dot")[0];
var n = document.getElementsByTagName("input");
var t = document.getElementsByTagName("button");
var res = 4128;
var scale = 10;
var size = 600;
var mapX = 0;
var mapZ = 0;
var options = {
	aSharp: true,
	aAdjust: true
};

var m = Object.values(options).length;

function a(b){return parseInt(n[b+m].value,10);}
function b(){return parseInt(mInner.style.height.match(/^(.*)px$/)[1]);}
function c(){return parseInt(map.style.height.match(/^(.*)px$/)[1]);}
function d(){return [dot.offsetLeft, dot.offsetTop];}

function resize(Size) {
	size = Size;
	map.style.height = size+"px";
	map.style.width = size+"px";
	panel.style.width = (size-8)+"px";
}

//c1.style.borderWidth = (2/parseFloat(mInner.style.transform.match(/^scale\((.*)\)$/)[1]))+"px";
//c2.style.borderWidth = (2/parseFloat(mInner.style.transform.match(/^scale\((.*)\)$/)[1]))+"px";

//resize(600);
resize(window.innerHeight-8*3-50);
mInner.style.height = size-200+"px";
mInner.style.width = size-200+"px";
</script>
<script>

function zoom(type, center) {
	if(type == "in") {
		if(b() < res) {		/* Zoom IN */
			var cc = b()+b()/scale;
			//var d = parseInt(mInner.style.top.match(/^(.*)px$/)[1]);
			mInner.style.height = cc+"px";
			mInner.style.width = cc+"px";
			Center(center[0], center[1]);
		}
	}
	else if(type == "out") {
		if(b() > (c()-200)/*400*/) {		/* Zoom OUT */
			var cc = b()-b()/scale;
			//var d = parseInt(mInner.style.top.match(/^(.*)px$/)[1]);
			mInner.style.height = cc+"px";
			mInner.style.width = cc+"px";
			Center(center[0], center[1]);
		}
	}
	else {
		console.error("Unknow zoom type \""+type+"\"");
		return false;
	}
}

function Center(x, z) {
	mInner.style.left = ((((b()/2)/(res/2)*x)*-1+(c()/2))-b()/2)/*+2*/+"px";
	/*mInner.style.top = ((((b()/2)/(res/2)*z)*-1+(c()/2))-b()/2)+"px";*/
	mInner.style.top = (-(b()*z/res)+((c()-b())/2))/*-4*/+"px";
	update();
	//updateCoords();
}

function getCenter() {
	var w = 0;
	return [Math.floor(res/b()*((d()[0]+w)-mInner.offsetLeft)-res/2), Math.floor(res/b()*((d()[1]-w)-mInner.offsetTop)-res/2)];
}

function updateCoords() {
	coords[1].innerHTML = "X:"+getCenter()[0]+" Z:"+getCenter()[1];
}

function update() {
	c1.style.left = (b()/res*(a(0)+res/2))+"px";
	c1.style.top = (b()/res*(a(1)+res/2))+"px";
	c1.style.height = (b()/res*a(2)*2)+"px";
	c1.style.width = (b()/res*a(2)*2)+"px";
	
	c2.style.left = (b()/res*(a(3)+res/2))+"px";
	c2.style.top = (b()/res*(a(4)+res/2))+"px";
	c2.style.height = (b()/res*a(5)*2)+"px";
	c2.style.width = (b()/res*a(5)*2)+"px";
	
	if(options.aSharp && b() > res/5*2) {
		mInner.style.imageRendering = "pixelated";
	}
	else {
		mInner.style.imageRendering = "auto";
	}
}

mInner.addEventListener("mousemove", function(e) {
	mapX = Math.floor(res/b()*(e.clientX-mInner.offsetLeft)-res/2);
	mapZ = Math.floor(res/b()*(e.clientY-mInner.offsetTop)-res/2);
	
	//coords.innerHTML = "X:"+Math.floor(Math.abs((mInner.offsetLeft-e.clientX)+((res*(1-b()))/2))/*+(res/b()-res)*//*-(res/2)*b()*/)+" Z:"+((mInner.offsetTop-e.clientY)+(res*(1-b())/2));
	coords[0].innerHTML = "X:"+mapX+" Z:"+mapZ;
});

n[0].addEventListener("change", function(e) {
	if(n[0].checked) options.aSharp = true;
	else options.aSharp = false;
	update();
	//updateCoords();
});
n[1].addEventListener("change", function(e) {
	var cen = getCenter();
	if(n[1].checked) {
		options.aAdjust = true;
		resize(window.innerHeight-8*3-50);
	}
	else {
		options.aAdjust = false;
		resize(600);
	}
	Center(cen[0], cen[1]);
	//update();
	//updateCoords();
});

Center(0, 0);
</script>
<script>

t[0].addEventListener("click", function() {
	Center(0, 0);
});
t[1].addEventListener("click", function() {
	var f = [getCenter()[0], getCenter()[1]];
	for(var i=0;i<5;i++) zoom("in", f);
});
t[2].addEventListener("click", function() {
	var f = [getCenter()[0], getCenter()[1]];
	for(var i=0;i<5;i++) zoom("out", f);
});

</script>
<script>


n[0+m].addEventListener("keyup", function() {
	c1.style.left = (b()/res*(a(0)+res/2))+"px";
});
n[1+m].addEventListener("keyup", function() {
	c1.style.top = (b()/res*(a(1)+res/2))+"px";
});
n[2+m].addEventListener("keyup", function() {
	c1.style.height = (b()/res*a(2)*2)+"px";
	c1.style.width = (b()/res*a(2)*2)+"px";
});

n[3+m].addEventListener("keyup", function() {
	c2.style.left = (b()/res*(a(3)+res/2))+"px";
});
n[4+m].addEventListener("keyup", function() {
	c2.style.top = (b()/res*(a(4)+res/2))+"px";
});
n[5+m].addEventListener("keyup", function() {
	c2.style.height = (b()/res*a(5)*2)+"px";
	c2.style.width = (b()/res*a(5)*2)+"px";
});

</script>
<script>

var draging = false;
var pos = [0,0,0,0];

map.addEventListener("mousedown", function(e) {
	//console.log(1);
	draging = true;
	map.style.cursor = "move";
	mInner.style.cursor = "move";
	mInner.style.transition = "top 0s, left 0s";
	pos[0] = e.clientX;
	pos[1] = e.clientY;
});

map.addEventListener("mouseup", function(e) {
	//console.log(2);
	draging = false;
	map.style.cursor = "default";
	mInner.style.cursor = "default";
	mInner.style.transition = ".25s";
});

document.addEventListener("mousemove", function(e) {
	if(e.target == mInner) return;
	mapX = 0;
	mapZ = 0;
	coords[0].innerHTML = ""/*"X: ? Z: ?"*/;
	if(e.target == map) return;
	if(!draging) return;
	//console.log(3);
	draging = false;
	map.style.cursor = "default";
	mInner.style.cursor = "default";
	mInner.style.transition = ".25s";
});

map.addEventListener("mousemove", function(e) {
	if(!draging) return;
	e.preventDefault();
	pos[2] = pos[0] - e.clientX;
    pos[3] = pos[1] - e.clientY;
    pos[0] = e.clientX;
    pos[1] = e.clientY;
	mInner.style.top = (mInner.offsetTop-pos[3]-(map.getBoundingClientRect().top+2))+"px";
	mInner.style.left = (mInner.offsetLeft-pos[2]-(map.getBoundingClientRect().left+2))+"px";
	update();
	updateCoords();
});

map.addEventListener("wheel", function(e) {
	//var a = parseFloat(mInner.style.transform.match(/^scale\((.*)\)$/)[1]);
	//var a = b()/*parseFloat(mInner.style.height.match(/^(.*)px$/)[1])*/;
	if(e.deltaY > 0) {
		zoom("out", [mapX, mapZ]);
		//if(a > 400) {		/* Zoom OUT */
			//var c = a-a/scale/* > 400 ? a-a/scale : 400*/;
			//var d = parseInt(mInner.style.top.match(/^(.*)px$/)[1]);
			//console.log(c+" "+d);
			/*mInner.style.height = c+"px";
			mInner.style.width = c+"px";
			Center(mapX, mapZ);*/
			/*if(options.aSharp && a < res/5*2) {
				mInner.style.imageRendering = "auto";
			}*/
			//mInner.style.top = (d+(c/10))+"px";
			//mInner.style.left = (d+(c/10))+"px";
		//}
		/*if(a > 0.04) {
			mInner.style.transform = "scale(" + (a-a/scale > 0.04 ? a-a/scale : 0.04) + ")";
		}*/
	}
	else {
		zoom("in", [mapX, mapZ]);
		//if(a < res) {		/* Zoom IN */
			//var c = a+a/scale/* < res ? a+a/scale : res*/;
			//var d = parseInt(mInner.style.top.match(/^(.*)px$/)[1]);
			/*mInner.style.height = c+"px";
			mInner.style.width = c+"px";
			Center(mapX, mapZ);*/
			/*if(options.aSharp && a > res/5*2) {
				mInner.style.imageRendering = "pixelated";
			}*/
			//mInner.style.top = (d-(c/10))+"px";
			//mInner.style.left = (d-(c/10))+"px";
		//}
		/*if(a < 1.0) {
			mInner.style.transform = "scale(" + (a+a/scale < 1.0 ? a+a/scale : 1.0) + ")";
		}*/
	}
	//c1.style.borderWidth = (2/parseFloat(mInner.style.transform.match(/^scale\((.*)\)$/)[1]))+"px";
	//c2.style.borderWidth = (2/parseFloat(mInner.style.transform.match(/^scale\((.*)\)$/)[1]))+"px";
});

mInner.addEventListener("transitionend", function() {
	updateCoords();
});

</script>
<script>
t[3].addEventListener("click", function() {
	var x1 = a(0), y1 = a(1), r1 = a(2);
	var x2 = a(3), y2 = a(4), r2 = a(5);
    if(x1 && y1 && r1 && x2 && y2 && r2) {

        var Dis, p, e1, e2, x1t, y1t, x2t, y2t;
        Dis = Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));
        p = Math.sqrt((Dis + r1 + r2) * (Dis + r1 - r2) * (Dis - r1 + r2) * (-Dis + r1 + r2)) / 4;
        e1 = (x1 + x2) / 2 + (x2 - x1) * (r1 * r1 - r2 * r2) / (2 * Dis * Dis);
        e2 = (y1 + y2) / 2 + (y2 - y1) * (r1 * r1 - r2 * r2) / (2 * Dis * Dis);

        x1t = e1 + 2 * (y1 - y2) * p / (Dis * Dis);
        y1t = e2 - 2 * (x1 - x2) * p / (Dis * Dis);
        x2t = e1 - 2 * (y1 - y2) * p / (Dis * Dis);
        y2t = e2 + 2 * (x1 - x2) * p / (Dis * Dis);
        
        
        n[6+m].value = "["+Math.round(x1t)+", "+Math.round(y1t)+"]";
        n[7+m].value = "["+Math.round(x2t)+", "+Math.round(y2t)+"]";
    }
    
});
</script>
<script>

/*var t = new Date().getTime();
var tt = setInterval(function(){
	if(t == t+600000) {document.getElementsByTagName("html")[0].childNodes[2].remove();clearInterval(tt);alert("Session Expred!");}
},1000);*/

</script>
</body>
</html>
